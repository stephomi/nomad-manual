# ![](/icons/sun.webp) 着色 {#shading}

此菜单用于控制 Nomad 使用的着色模式、灯光属性以及环境光 / Matcap 属性。

![](/images/shading_overview.webp)



你可以在多种渲染模式之间进行选择：

| Mode                        | Meaning                    | Description                                                     |
| :-------------------------: | :------------------------: | :-------------------------------------------------------------: |
| [Lit(PBR)](#pbr)            | 物理化渲染                 | 使用金属度/粗糙度进行绘制                                       |
| [Matcap](#matcap)           | 材质捕捉                   | 雕刻时使用，比 PBR 占用更少的 GPU/CPU 资源                      |
| [Unlit](#unlit)             | 表面颜色                   | 仅显示表面颜色，不进行任何着色或打光                           |
| [Object Id](#object-id)      | 对象 ID                    | 每个对象随机一种颜色，适合在绘画软件中使用                     |
| [Instance Id](#instance-id)  | 实例 ID                    | 每个实例随机一种颜色，便于识别共享网格                         |

如果你想进一步了解金属度和粗糙度，请参阅 [顶点绘制](painting.md) 章节。

---

![](/images/shading_second.webp)

### 面组 {#face-group}
叠加显示面组颜色。面组是多边形的彩色选区，可以使用 [Face group](tools#facegroup) 工具创建，大多数基础体在创建时也会自动生成面组。

当面组可见时，一些工具会自动按面组进行过滤。

### 显示绘制 {#show-paint}
Nomad 可以在雕塑的顶点中存储颜色、粗糙度和金属度。你可以通过此复选框全局切换这些属性的显示。

注意：如果同时存在顶点属性和纹理，并且两者都启用，那么它们的数值会相乘叠加。

### 显示遮罩 {#show-mask}
切换 [遮罩工具](tools#mask) 的灰度遮罩叠加显示。关闭时遮罩也会被禁用，这在你想临时不受遮罩影响进行快速修改时很有用，之后重新启用即可继续使用原有遮罩。

### 使用隐藏 {#use-hide}

切换隐藏面显示。注意：这只在你**不在** Hide 工具中时有效！

### 使用纹理 {#use-textures}

Nomad 允许在 [材质](material) 菜单中为对象指定纹理。如果对象已分配纹理，可以通过此复选框全局开关纹理显示。







### PBR 与灯光概览 {#pbr}
本手册不会深入讲解物理化渲染（PBR）的技术细节。

有一点非常重要：灯光与材质是完全分离的。  
这意味着你可以独立绘制对象的颜色、粗糙度和金属度，而灯光则单独控制。  
这样你可以先专注于绘制对象本身，然后再调整灯光，而不会破坏模型整体观感。

灯光仅在 [PBR 模式](#pbr) 下可用。  
出于性能考虑，最多只能使用 4 盏灯。

::: tip
你可以加载包含超过 4 盏灯的 glTF 文件，Nomad 会保留所有灯光。  
但性能可能会明显下降。
:::

::: tip
你可以通过将对象设置为 Unlit/自发光，再在 [后期处理](postprocess) 菜单中启用全局光照，来“伪造”出许多灯光效果。
:::

### 灯光类型概览 {#light-types-overview}

当前支持的灯光类型如下：

| Mode                        | Description                                             | Can cast shadows                                       |
| :-------------------------: | :-----------------------------------------------------: | :----------------------------------------------------: |
| [Directional](#directional) | 无限远的太阳光                                         | yes                                                    |
| [Environment](#environment) | 与环境 HDR 匹配的远处光源                              | yes                                                    |
| [Spot](#spot)               | 锥形聚光灯                                             | Yes                                                    |
| [Point](#point)             | 全向点光源                                             | Yes, but only through less robust screen-space shadows |

#### 平行光 {#directional}
发出来自无限远处的光线，强度均匀。  
在场景中的 3D 位置无关紧要，只与方向有关。

你可以将此灯光附加到相机上，这样可以获得一致的打光效果。  
例如，你可以用它做轮廓光（从模型背后朝向相机的强光），并让它始终从角色背后打光。

#### 环境光 {#env-light}
使用 [环境 HDR](#environment) 可以很好地模拟整体柔和光照，但如果 HDR 中有非常强烈、锐利的光源，其产生的阴影会非常柔和，甚至几乎不可见。  
配合一个方向光可以改善这一点，但要让两者方向对齐可能比较困难。

这种灯光会自动完成对齐工作。它会自动旋转，使其方向与 HDR 中最亮的区域对齐，然后你可以单独控制其强度和角度（阴影柔和度）。

#### 聚光灯 {#spot}
聚光灯会沿单一方向发光，并被一个锥形区域所限制。

#### 点光源 {#point}
点光源会向所有方向发光。  
目前点光源不支持阴影。

#### 阴影 {#shadows}
`normal bias` 选项可用于减少常见的阴影伪影（acne/peter-panning）。

阴影质量取决于对象相对于整个场景的尺寸。  
如果场景中有很大的对象且不需要投射阴影（例如一个大平面），请在其 [材质设置](material.md#cast-shadows) 中关闭投射阴影，以提升整体阴影质量。

## 灯光 {#lights}

![](/images/shading_lights.webp)

### ![](/icons/checked.webp) 灯光复选框 {#lights-checkbox}

切换场景中所有直接光源的开关。



### 添加灯光 {#add-light}

向场景中添加一盏灯，最多 4 盏。添加灯光后，会显示灯光列表及其按钮，并在视口顶部出现灯光工具栏。

![](/images/shading_lights_icons.webp)

* 文本显示灯光名称和亮度。
* 眼睛图标切换灯光可见性。
* 铅笔图标用于重命名灯光。
* 垃圾桶图标删除灯光。
* 复制图标会复制一盏灯。
* 三点图标会打开完整的灯光编辑器。大部分功能也可以通过视口中出现的工具栏访问。

### ![](/icons/spotlight.webp) 图标 {#icons}

切换视口中灯光图标的显示。

### 灯光工具栏 {#light-toolbar}
![](/images/shading_lights_toolbar.webp) 

当选中某盏灯时，此工具栏会出现在视口顶部。

* Show 用于切换灯光可见性。
* Directional/Environment/Spot/Point 用于切换灯光类型。轻点循环切换，长按弹出菜单。
* Intensity 控制灯光强度，数值可以大于 1.0，用于非常强烈的灯光，配合后期中的全局光照效果很好。
* 点击颜色样本会弹出颜色选择器。Nomad 提供多种选色方式，其中色温（Kelvin）控制可以自然地选择冷暖光。
* Shadow 切换阴影开关。
* Size 设置灯光的宽度。更宽的灯光会产生更柔和的阴影、更柔和的光照以及更柔和的高光。
* ... 打开更多控制选项。

### 灯光额外控制 {#light-extra-controls}

![](/images/shading_extra_controls.webp) 

注意：某些选项仅适用于特定灯光类型。

* `Clone` 复制当前灯光。
* `Recenter` 将灯光移动回场景原点。
* `Delete` 删除当前灯光。
* `Directional/Environment/Spot/Point` 用于切换灯光类型。
* 点击 `颜色样本` 会弹出颜色选择器。
* `Intensity` 控制灯光强度。
* `Attachment`（仅方向光）设置灯光附加到世界或相机。  
  例如：如果你在角色背后使用方向光作为轮廓光，当选择附加到相机时，旋转相机时灯光会始终保持在角色背后。
* `Angle`（仅方向光和环境光）为灯光的视角大小，可理解为太阳在天空中的“看起来有多大”。角度越大，阴影越柔和，高光越宽。
* `Softness`（仅聚光灯）控制聚光灯锥形边缘的锐利程度。0 为非常锐利的边缘，1 为非常柔和，光锥中心有渐变。在视口中，可以通过聚光灯锥形上的蓝色小点交互式调整柔和度。
* `Cone angle`（仅聚光灯）控制聚光灯的张角。角度小则光束很细，170 则为非常宽的光束。在视口中，可以通过橙色小点交互式调整光锥角度。
* `Shadow` 切换当前灯光的阴影开关。
* `Shadow map` 和 `screenspace` 是两种不同的阴影计算方式，一般来说 Shadow map 更可靠。
* `Contact` 调整阴影的计算方式。阴影在计算机图形中是个难题，容易产生伪影。可以为场景中最重要的灯光选择更精确的阴影计算方式，此选项用于决定由 Nomad 自动选择最重要的灯光，还是由用户手动指定。
* `Tolerance` 当出现阴影伪影（例如阴影似乎没有贴合表面，或阴影中有噪点和花纹）时，调整此值可以帮助修复问题。


## 环境 {#environment}

![](/images/shading_environment.webp)

现实世界中的光线来自四面八方：天空的蓝色、草地的绿色、建筑的红色，这些来自“环境”的光线都可以通过环境贴图来模拟。

Nomad 自带多种室内和室外环境贴图，具有不同的色调和亮度。可以多试几种，看看哪一种最能表现你雕塑的细节。

点击图片可以查看可用的环境贴图。在弹出的对话框中选择 “Import...” 可以加载你自己的贴图。  
推荐使用高动态范围（HDR）图像，采用 latlong 或 equirectangular 格式，文件类型为 .hdr 或 .exr。  
[www.polyhaven.com](https://polyhaven.com/hdris) 提供了大量免费的环境贴图，一般 1k 分辨率的 HDR 贴图在质量和体积之间有不错的平衡。

### 曝光 {#env-exposure}
调整环境贴图的亮度。  
在与常规灯光一起使用时，环境贴图往往会显得过亮，降低曝光可以帮助平衡，尤其是在 [后期处理](postprocess) 中启用全局光照时。

### 旋转 {#env-rotation}

由于环境贴图捕捉的是来自各个方向的光线，你可以旋转它们，以获得与你雕塑更契合的反射和整体光照。

### 附加到相机 {#env-attached}
将环境贴图附加到相机。

这会强制光照方向保持一致，在雕刻过程中有助于保持稳定的视觉反馈。


## ![](/icons/sphere_smooth.webp) Matcap {#matcap}

![](/images/shading_matcap.webp)

顾名思义（MATerial CAPture），Matcap 在一张图像中同时包含了光照和材质信息。  
由于材质信息已经包含在 Matcap 中，粗糙度和金属度绘制通道会被忽略。  
绘制的颜色会与 Matcap 相乘，也就是说，如果使用的是黑色/灰色 Matcap，即使用白色绘制也不会变得更亮。

艺术家在雕刻阶段通常偏爱这种模式，因为它能让他们更专注于形体和几何本身。

点击球体会打开图像浏览器。你也可以添加自己的 Matcap，一般任何照片、渲染图，甚至是一张裁剪成正方形的球体绘画都可以用作 Matcap。  
网上有许多 Matcap 资源库，一个很有用的资源是 [nidorx matcap library](https://github.com/nidorx/matcaps)。

### 使用全局 Matcap {#matcap-global}

通常艺术家会为整个雕塑使用同一个 Matcap，但如果关闭此开关，每个对象都可以拥有自己的 Matcap。  
这可以用于艺术化表现，获得非常醒目的效果。

::: tip
关闭此选项，然后为角色的眼睛使用一张眼球图像作为 Matcap！
:::

### 旋转 {#matcap-rotation}
Matcap 是一种特殊形式的环境贴图，因此也可以像环境贴图一样旋转。  
你也可以在视口中随时用三指左右拖动来旋转 Matcap。



## ![](/icons/circle_fill.webp) 无光照 {#unlit}

此模式只显示表面颜色。  
当你想检查对象的表面颜色是否符合预期，而不被灯光、阴影、反射、透明度等干扰时，这非常有用。

此模式也可用于非写实渲染，获得平涂、卡通化的效果。

## ![](/icons/cube.webp) 对象 ID {#object-id}

忽略所有光照和表面信息，每个对象以唯一的纯色进行着色。  
如果与 PBR 渲染一起导出，在绘画软件中可以通过颜色选择来选中对象，从而对特定对象进行颜色校正。

注意：这些颜色也会出现在 [场景菜单树视图](scene#tree-view) 中。

### 随机化 ID {#object-random}

生成一组新的随机颜色。

## ![](/icons/link.webp) 实例 ID {#instance-id}

与 Object ID 类似，但同一网格的实例会使用相同的颜色。

### 随机化 ID {#instance-random}

生成一组新的随机颜色。